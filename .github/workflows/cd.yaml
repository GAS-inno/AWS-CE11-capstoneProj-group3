name: Legacy CD Pipeline (Deprecated)
# This file is deprecated - use deploy.yml or deploy-multi-env.yml instead

on:
  # Disabled to prevent conflicts with new workflows
  workflow_dispatch:
    inputs:
      confirm_legacy:
        description: 'Type "confirm" to use this deprecated workflow'
        required: true
        type: string

permissions:
  contents: read
  id-token: write

jobs:
  check-legacy:
    runs-on: ubuntu-latest
    steps:
      - name: Validate legacy usage
        run: |
          if [ "${{ github.event.inputs.confirm_legacy }}" != "confirm" ]; then
            echo "❌ This workflow is deprecated."
            echo "✅ Use 'deploy.yml' for main deployments"
            echo "✅ Use 'deploy-multi-env.yml' for environment-specific deployments"
            echo "✅ Use 'terraform.yml' for infrastructure management"
            exit 1
          fi
          echo "⚠️ Using deprecated workflow. Please migrate to new workflows."
      
      - name: Setup Terraform (Legacy)
        uses: hashicorp/setup-terraform@v2
        with:
          terraform_version: 1.5.6

      # Step 2: Configure AWS credentials (OIDC recommended)
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: us-east-1


      - name: Terraform Init
        run: terraform init
        working-directory: ./terraform

      - name: Terraform Apply
        run: terraform apply -auto-approve
        working-directory: ./terraform